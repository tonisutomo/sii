PrimeFaces.widget.AccordionPanel=PrimeFaces.widget.BaseWidget.extend({init:function(a){this._super(a);this.stateHolder=$(this.jqId+"_active");this.headers=this.jq.children(".ui-accordion-header");this.panels=this.jq.children(".ui-accordion-content");this.cfg.rtl=this.jq.hasClass("ui-accordion-rtl");this.cfg.expandedIcon="ui-icon-triangle-1-s";this.cfg.collapsedIcon=this.cfg.rtl?"ui-icon-triangle-1-w":"ui-icon-triangle-1-e";this.focusedHeader=null;this.initActive();this.bindEvents();if(this.cfg.dynamic&&this.cfg.cache){this.markLoadedPanels()}},initActive:function(){var b=0;if(this.cfg.multiple){var a=this.stateHolder.val().split(",");for(var c=0;c<a.length;c++){a[c]=parseInt(a[c])}this.cfg.active=a}else{this.cfg.active=parseInt(this.stateHolder.val())}if(this.cfg.multiple){b=this.cfg.active[0]}else{b=this.cfg.active}for(var c=0;c<this.headers.length;c++){if(b===c&&!this.headers.eq(c).hasClass("ui-state-disabled")){this.headers.eq(c).attr("tabindex","0")}else{this.headers.eq(c).attr("tabindex","-1")}}if(this.headers.filter('[tabindex="-1"]').length===this.headers.length){this.headers.filter("h3:not(.ui-state-disabled):first").attr("tabindex","0")}},bindEvents:function(){var a=this;this.headers.mouseover(function(){var b=$(this);if(!b.hasClass("ui-state-active")&&!b.hasClass("ui-state-disabled")){b.addClass("ui-state-hover")}}).mouseout(function(){var b=$(this);if(!b.hasClass("ui-state-active")&&!b.hasClass("ui-state-disabled")){b.removeClass("ui-state-hover")}}).click(function(d){var c=$(this);if(!c.hasClass("ui-state-disabled")){var b=c.index()/2;if(c.hasClass("ui-state-active")){a.unselect(b)}else{a.select(b);$(this).trigger("focus.accordion")}}d.preventDefault()});this.bindKeyEvents()},bindKeyEvents:function(){var a=this;this.headers.on("focus.accordion",function(){a.focusedHeader=$(this);if(!a.focusedHeader.hasClass("ui-state-disabled")){a.headers.filter('[tabindex="0"]').attr("tabindex","-1").removeClass("ui-tabs-outline");a.focusedHeader.attr("tabindex","0").addClass("ui-tabs-outline")}}).on("blur.accordion",function(){if(a.focusedHeader){a.focusedHeader.removeClass("ui-tabs-outline")}}).on("keydown.accordion",function(c){var b=$.ui.keyCode;switch(c.which){case b.LEFT:case b.UP:if(a.focusedHeader){if((a.focusedHeader.index()/2)===0){a.focusedHeader=a.headers.filter("h3:not(.ui-state-disabled):last")}else{a.focusedHeader=a.focusedHeader.prevAll("h3:not(.ui-state-disabled):first");if(!a.focusedHeader.length){a.focusedHeader=a.headers.filter("h3:not(.ui-state-disabled):last")}}a.focusedHeader.trigger("focus.accordion")}c.preventDefault();break;case b.RIGHT:case b.DOWN:if(a.focusedHeader){if((a.focusedHeader.index()/2)===(a.headers.length-1)){a.focusedHeader=a.headers.filter("h3:not(.ui-state-disabled):first")}else{a.focusedHeader=a.focusedHeader.nextAll("h3:not(.ui-state-disabled):first");if(!a.focusedHeader.length){a.focusedHeader=a.headers.filter("h3:not(.ui-state-disabled):first")}}a.focusedHeader.trigger("focus.accordion")}c.preventDefault();break;case b.ENTER:case b.NUMPAD_ENTER:case b.SPACE:if(a.focusedHeader){a.focusedHeader.trigger("click")}c.preventDefault();break}})},markLoadedPanels:function(){if(this.cfg.multiple){for(var a=0;a<this.cfg.active.length;a++){if(this.cfg.active[a]>=0){this.markAsLoaded(this.panels.eq(this.cfg.active[a]))}}}else{if(this.cfg.active>=0){this.markAsLoaded(this.panels.eq(this.cfg.active))}}},select:function(c){var b=this.panels.eq(c);if(this.cfg.onTabChange){var a=this.cfg.onTabChange.call(this,b);if(a===false){return false}}var d=this.cfg.dynamic&&!this.isLoaded(b);if(this.cfg.multiple){this.addToSelection(c)}else{this.cfg.active=c}this.saveState();if(d){this.loadDynamicTab(b)}else{this.show(b);if(this.hasBehavior("tabChange")){this.fireTabChangeEvent(b)}}return true},unselect:function(b){var a=this.panels.eq(b),c=a.prev();c.attr("aria-selected",false);c.attr("aria-expanded",false).children(".ui-icon").removeClass(this.cfg.expandedIcon).addClass(this.cfg.collapsedIcon);c.removeClass("ui-state-active ui-corner-top").addClass("ui-corner-all");a.attr("aria-hidden",true).slideUp();this.removeFromSelection(b);this.saveState();if(this.hasBehavior("tabClose")){this.fireTabCloseEvent(a)}},show:function(c){var b=this;if(!this.cfg.multiple){var d=this.headers.filter(".ui-state-active");d.children(".ui-icon").removeClass(this.cfg.expandedIcon).addClass(this.cfg.collapsedIcon);d.attr("aria-selected",false);d.attr("aria-expanded",false).removeClass("ui-state-active ui-corner-top").addClass("ui-corner-all").next().attr("aria-hidden",true).slideUp()}var a=c.prev();a.attr("aria-selected",true);a.attr("aria-expanded",true).addClass("ui-state-active ui-corner-top").removeClass("ui-state-hover ui-corner-all").children(".ui-icon").removeClass(this.cfg.collapsedIcon).addClass(this.cfg.expandedIcon);c.attr("aria-hidden",false).slideDown("normal",function(){b.postTabShow(c)})},loadDynamicTab:function(a){var c=this,b={source:this.id,process:this.id,update:this.id,params:[{name:this.id+"_contentLoad",value:true},{name:this.id+"_newTab",value:a.attr("id")},{name:this.id+"_tabindex",value:parseInt(a.index()/2)}],onsuccess:function(g,e,f){PrimeFaces.ajax.Response.handle(g,e,f,{widget:c,handle:function(h){a.html(h);if(this.cfg.cache){this.markAsLoaded(a)}}});return true},oncomplete:function(){c.show(a)}};if(this.hasBehavior("tabChange")){var d=this.cfg.behaviors.tabChange;d.call(this,b)}else{PrimeFaces.ajax.AjaxRequest(b)}},fireTabChangeEvent:function(a){var c=this.cfg.behaviors.tabChange,b={params:[{name:this.id+"_newTab",value:a.attr("id")},{name:this.id+"_tabindex",value:parseInt(a.index()/2)}]};c.call(this,b)},fireTabCloseEvent:function(a){var c=this.cfg.behaviors.tabClose,b={params:[{name:this.id+"_tabId",value:a.attr("id")},{name:this.id+"_tabindex",value:parseInt(a.index()/2)}]};c.call(this,b)},markAsLoaded:function(a){a.data("loaded",true)},isLoaded:function(a){return a.data("loaded")==true},hasBehavior:function(a){if(this.cfg.behaviors){return this.cfg.behaviors[a]!=undefined}return false},addToSelection:function(a){this.cfg.active.push(a)},removeFromSelection:function(a){this.cfg.active=$.grep(this.cfg.active,function(b){return b!=a})},saveState:function(){if(this.cfg.multiple){this.stateHolder.val(this.cfg.active.join(","))}else{this.stateHolder.val(this.cfg.active)}},postTabShow:function(a){if(this.cfg.onTabShow){this.cfg.onTabShow.call(this,a)}PrimeFaces.invokeDeferredRenders(this.id)}});